---
layout: post
title:  "ğŸŒˆ From-scratched Pose-graph SLAM Tutorial: 1í¸"
date:   2024-08-24 01:00:00 +0000
categories: SLAM
---

# Single Rotation Averaging ì„ êµ¬í˜„í•´ë³´ì
- ì–´ë µì§€ ì•Šì•„ìš” 
- $\text{SO(3)}$ ì™€ $\mathfrak{so(3)}$ ë¯¸ë¶„ ê³ ìˆ˜ë˜ëŠ” ë²•

## ê°œìš” 
- Rotation averaging ì€ SfM (Structure-from-motion), SLAM ë“±ì—ì„œ ìì£¼ ë“±ì¥í•˜ëŠ” task ì´ë‹¤. 
    - ps. rotation averaging ì´ ë¬´ì—‡ì¸ì§€ì— ëŒ€í•´ì„œëŠ” ë‹¤ìŒ ë…¼ë¬¸ì„ ì°¸ê³ . 
        - [Rotation Averaging by Richard Hartley, et al.](https://users.cecs.anu.edu.au/~hartley/Papers/PDF/Hartley-Trumpf:Rotation-averaging:IJCV.pdf)
        - ì´ ë…¼ë¬¸ì„ ì¸ìš©í•œ ë…¼ë¬¸ë“¤ ì¤‘ ì¸ìš©ìˆ˜ê°€ ë§ì€ ê²ƒì„ ë³´ëŠ” ê²ƒ ë˜í•œ ë„ì›€ì´ ë˜ê² ë‹¤. 
- ì™œ í•„ìš”í•œê°€? 
    - ëŒ€ë¶€ë¶„ì˜ geometric computer vision ë¬¸ì œì—ì„œ, residual ì„ ìµœì†Œí™” í•  ë•Œ, 
    - í˜„ì¬ solutionìœ¼ë¡œë¶€í„° delta ë§Œí¼ ì¡°ê¸ˆì”© ì´ë™í•´ë‚˜ê°€ë©´ì„œ ìµœì¢… solution ìœ¼ë¡œ ìˆ˜ë ´í•´ë‚˜ê°€ëŠ”ë° (i.e., Gauss-Newton),
    - ì´ ì‘ì—…ì€ vector space ì—ì„œë§Œ ê°€ëŠ¥í•˜ë¯€ë¡œ, 
    - nonlinear í•œ term ë“¤ì„ êµ­ì†Œì ìœ¼ë¡œ linearization í•´ì£¼ì–´ì•¼ í•˜ëŠ”ë°, 
        - ì´ ì´ì•¼ê¸°ì— ëŒ€í•œ ë” ìì„¸í•œ ì„¤ëª…ì€ [ì˜ˆì „ í¬ìŠ¤íŠ¸]({{ site.baseurl }}{% post_url 2023-12-16-nano-lie-theory %}) ë¥¼ ì°¸ê³ . 
    - ì´ ë•Œ, ì§ì „ solution ì´ ì•ˆ ì¢‹ë‹¤ë©´ (== global solution ìœ¼ë¡œë¶€í„° ë©€ë‹¤ë©´) 
    - í•´ê°€ ìˆ˜ë ´í•˜ê¸° ì–´ë µë‹¤. 
    - ì´ê²ƒì´ SfM or SLAM ì—ì„œ ë”ìš± ë¬¸ì œê°€ ë˜ëŠ” ê±´, 
    - N ê°œì˜ ë…¸ë“œ (ìˆ˜ì‹­ê°œì¼ìˆ˜ë„, ìˆ˜ì²œ ìˆ˜ë§Œ ê°œ ì¼ìˆ˜ë„) ì˜ pose ë¥¼ ëª¨ë‘ joint í•˜ê²Œ ìµœì í™” í•˜ëŠ” ë¬¸ì œë¥¼ í‘¸ëŠ” ê²ƒì´ SfM or SLAM ì¸ë° 
    - rotation ì´ nonlinear í•œ ìš”ì†Œì´ê³ , 
    - Gauss-newton ê³¼ì •ì—ì„œ, rotation ë¶€ë¶„ì˜ current solution ì´ ì•ˆì¢‹ë‹¤ë©´ ì´ëŠ” pose ì¤‘ rotation ì´ ì•„ë‹ˆë¼ position ë¶€ë¶„ì—ë„ ì•…ì˜í–¥ì„ ë¼ì¹  ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤ (ê·¸ë¦¬ê³  ë§ˆì°¬ê°€ì§€ë¡œ ê·¸ëŸ¬í•œ í•œ ë…¸ë“œì˜ ì—ëŸ¬ê°€ ë‹¤ë¥¸ ë…¸ë“œë“¤ì—ë„ ì•…ì˜í–¥ì„ ë¼ì¹  ìˆ˜ë„ ìˆê² ë‹¤). 
- ê·¸ë˜ì„œ, íŠ¹íˆ nonlinear í•œ termì¸ rotation ë¶€ë¶„ì„ global solutionì— ì˜ ë§ê²Œ ì´ˆê¸°ê°’ì„ ì˜ ì„¤ì •í•´ë‘˜ ìˆ˜ ìˆë‹¤ë©´, translation loss ë“±ì€ ë˜í•œ ì‰½ê²Œ í’€ë¦´ ìˆ˜ ìˆì„ ê²ƒì´ë‹¤. 
- ì˜ˆë¥¼ ë“¤ì–´ì„œ, í•˜ë‚˜ì˜ ë…¸ë“œ (pose) ì˜ rotation (attitude) ì— ëŒ€í•œ measurement ê°€ k ê°œ ìˆì„ ë•Œ, ì´ê²ƒì„ ìˆ˜ë§Œê°œ ë…¸ë“œì˜ joint optimization ì„ í’€ ë•Œ ëª¨ë‘ constraint ë¡œ ë„£ì–´ì£¼ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, k ê°œì˜ measurement ë“¤ì„ ì˜ ë¶„ì„í•´ì„œ ì‹ ë¢°í• ë§Œí•œ í•˜ë‚˜ì˜ ê°’ë§Œì„ ë„ì¶œí•œ ë‹¤ìŒ, ê·¸ê²ƒë§Œì„ ì „ì²´ ìµœì í™” ë¬¸ì œì˜ constraint ë¡œ ì¶”ê°€í•´ì¤„ ìˆ˜ ìˆê² ë‹¤. 
- ì¦‰, **single rotation averaging** ì´ë¼ëŠ” taskëŠ”, 
    - **í•˜ë‚˜**ì˜ ë…¸ë“œ (pose) ì˜ rotation (attitude) ì— ëŒ€í•œ measurement ê°€ k ê°œ ìˆì„ ë•Œ, 
    - ì´ ì¸¡ì •ì¹˜ë“¤ì„ ëª¨ë‘ ì ë‹¹íˆ ë§Œì¡±í•˜ë„ë¡ ê³ ë ¤í–ˆì„ ë•Œ, 
    - ê·¸ ë…¸ë“œì˜ rotation (attitude or orientation ë“±ìœ¼ë¡œë„ ë¶ˆë¦¼) ì€ ê·¸ë˜ì„œ ìµœì¢…ì ìœ¼ë¡œ ë¬´ì—‡ì¸ê°€, ì— ëŒ€í•œ ëŒ€ë‹µì„ í•˜ëŠ” ë¬¸ì œì´ë‹¤. 
- rotation (i.e., SO(3)) ì€ vector space ì— ì‚´ê³  ìˆì§€ ì•Šê¸° ë•Œë¬¸ì—, ë‹¨ìˆœíˆ xyz ë“¤ì„ k ë¡œ ë‚˜ëˆ„ëŠ”, ì¦‰, $ \textbf{sum}(\textbf{R}_1, \textbf{R}_2, \textbf{R}_3) / 3$ ê³¼ ê°™ì´ ë‚˜ì´ë¸Œí•˜ê²Œ ê³„ì‚°í•  ìˆ˜ëŠ” ì—†ë‹¤.  
- ë¬¼ë¡  sum ì´ë¼ëŠ” í•¨ìˆ˜ì™€ / ë¼ëŠ” ë‚˜ëˆ—ì…ˆì„ ì–´ë–»ê²Œ ì •ì˜í• ê±°ëƒì— ë‹¬ë¦°ê²ƒì´ê¸´ í•˜ì§€ë§Œ... ì—¬ê¸°ì—ì„œ ì´ì•¼ê¸°í•˜ë ¤ê³  í•˜ëŠ” ê²ƒì€ ì €ëŸ° deterministic í•œ ê³„ì‚°ì„ í•œ ë°©ì— í•˜ë ¤ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ëŒ€ì‹ ì— iteratively ì¡°ì •í•´ë‚˜ê°€ëŠ” ê³¼ì •ì„ ì–´ë–»ê²Œ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠëƒ? í•˜ëŠ” ì ì´ë‹¤. ì¦‰, ì € í‰ê· ì¡°ì°¨ë„ iterative í•˜ê²Œ ì–»ì–´ì ¸ì•¼ í•œë‹¤ëŠ” ê²ƒì´ë‹¤. ì´ëŠ” ë‹¤ì‹œ ë§í•˜ì§€ë§Œ rotation ì´ ì‚´ê³  ìˆëŠ” ê³µê°„ì€ nonlinear í•˜ê³  êµ­ì†Œì ìœ¼ë¡œ (== iterative optimization ì´ ìˆ˜í–‰ë˜ëŠ” tangent space) ë§Œ vector space ì´ê¸° ë•Œë¬¸ì— ì €ëŸ° ì¼ë°˜ ì—°ì‚°ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤. 
<!-- - ì¦‰, rotation averaging ì€ ë²ˆì—­ì²´ ê·¸ëŒ€ë¡œ ì´ì•¼ê¸°í•˜ë©´ ì¢€ ì–´ìƒ‰í•  ìˆ˜ë„ ìˆê² ë‹¤. ê·¸ê²ƒì˜ ì˜ë¯¸ëŠ” í‰ê· ì´ê¸°ëŠ” í•˜ì§€ë§Œ, ì‹¤ì œë¡œ ê·¸ê²ƒì´ ì–»ì–´ì§€ëŠ” numerically mechanical í•œ ê³¼ì •ì€ ìµœì í™”ì´ê¸° ë•Œë¬¸ì´ë‹¤. ì¸¡ì •ì¹˜ë“¤ì„ ëª¨ë‘ ë§Œì¡±í•˜ëŠ” solutionì„ (ìµœì í™”ë¥¼ í†µí•´) êµ¬í•˜ëŠ” ì¼ì´ë¼ê³  í•´ì„í•´ì•¼ í•  ê²ƒì´ë‹¤.  -->
- ìœ„ ë…¼ë¬¸ [Rotation Averaging by Richard Hartley, et al.](https://users.cecs.anu.edu.au/~hartley/Papers/PDF/Hartley-Trumpf:Rotation-averaging:IJCV.pdf) ì—ì„œëŠ” rotation definitionì„ ë¨¼ì € í•˜ê³ , ìœ ìš©í•œ ì„±ì§ˆë“¤ì— ëŒ€í•´ ì´ì•¼ê¸° í•œ ë’¤, ì—¬ëŸ¬ distance ì— ëŒ€í•´ì„œë„ ë…¼ì˜í•˜ê³ , ë©”ì¸ì—ì„œëŠ” 1. single rotation averaging ê³¼ 2. multiple rotation averaging ì— ëŒ€í•´ ì´ì•¼ê¸°í•œë‹¤. 
- ê·¸ ì¤‘, ì´ í¬ìŠ¤íŠ¸ì—ì„œëŠ” 1. single rotation averaging  ì— ëŒ€í•´ì„œë§Œ ì•Œì•„ë³¼ ê²ƒì´ë‹¤. 
    - rotation ì˜ ì •ì˜ë‚˜ ê¸°ë³¸ì ì¸ ì„±ì§ˆì— ëŒ€í•´ì„œëŠ” ë…ìê°€ ì•Œê³ ìˆë‹¤ê³  ê°€ì •í•œë‹¤. 
    - ê·¸ë‚˜ì €ë‚˜ 2. multiple rotation averaging ëŠ” rotation only pose-graph optimization ì´ë¼ê³ ë„ ë¶ˆë¦°ë‹¤. 
- ê·¸ë¦¬ê³  ìœ„ ë…¼ë¬¸ì„ ë³´ë©´ rotation ì´ ì‚´ê³ ìˆëŠ” ê³µê°„ì—ì„œ distance ë¥¼ ì •ì˜í•˜ëŠ” ë°©ì‹ì´ ì—¬ëŸ¬ ê°œê°€ ìˆìŒì„ ì•Œ ìˆ˜ ìˆëŠ”ë°, ë³¸ í¬ìŠ¤íŠ¸ì—ì„œëŠ” ê°€ì¥ ê¸°ë³¸ì ì´ê³  ì •ì„ì ì¸ tangent space ì—ì„œì˜ L2 loss ë¡œ ì •ì˜í•  ê²ƒì´ë‹¤. ê·¸ë¦¬ê³  ê·¸ ì°¨ì´ë¥¼ iteratively ì¤„ì—¬ë‚˜ê°€ë©´, ì›ë˜ rotation ê³µê°„ (we call it manifold, SO(3)) ì—ì„œë„ ìµœì í™”ê°€ ë˜ì–´ìˆëŠ”ì§€ ë³´ì¼ ê²ƒì´ë‹¤. 

## í‹°ì € 
- ì´ í¬ìŠ¤íŠ¸ì—ì„œëŠ”, single rotation averaging ì„ from scratch ë¡œ êµ¬í˜„í•´ë³´ê³  ì‹¤ìŠµí•´ë³´ì. 
- í‹°ì € 
    - ê²°ê³¼ë¶€í„° ë¨¼ì € ë³´ì´ìë©´ ì•„ë˜ ê·¸ë¦¼ê³¼ ê°™ë‹¤. 
        - ì„¤ëª… 
            - ë¹¨ê°•, ì²­ë¡, ë…¸ë‘ axes ë“¤ì€, ì–´ë–¤ ë¡œë´‡ì˜ ì–´ë–¤ ì‹œì ì—ì„œì˜ ëŒ€í•œ ìì„¸ (rotation, attitude, orientation ë“±ìœ¼ë¡œ ë¶ˆë¦¼) ì˜ˆì¸¡ ê°’ì„ ì˜ë¯¸í•œë‹¤. 
                - ì˜ˆë¥¼ ë“¤ì–´ì„œ ë™ì¼í•œ ì„¼ì„œë¡œ ì„¸ ë²ˆ ì¸¡ì •í–ˆëŠ”ë°, í˜„ì‹¤ì„¸ê³„ì˜ ì„¼ì„œë€ noisy í•˜ê³  ë¶ˆì™„ì „í•˜ë¯€ë¡œ ì¡°ê¸ˆì”© ì €ë ‡ê²Œ ë‹¤ë¥¸ ê²°ê³¼ê°€ ë‚˜ì˜¬ ìˆ˜ ìˆê² ë‹¤. 
            - ê·¸ëŸ¬ë©´ ì € ì…‹ ì •ë³´ë¥¼ ëª¨ë‘ ë§Œì¡±í•˜ëŠ” (== ê°œë…ì ìœ¼ë¡œ í‰ê· , ì‹¤ì œ ê³„ì‚°ì€ iterative optimization) ê°’ì„ êµ¬í•´ì„œ, ë¡œë´‡ì˜ ìì„¸ëŠ” ì´ê²ƒì´ì•¼! ë¼ê³  ë§í•´ì•¼ í• í…ë°, 
            - ê·¸ ê²°ê³¼ëŠ” íŒŒë‘ìƒ‰ ì¶•ì´ë‹¤. 
            - ì¼ë‹¨ ì‚¬ëŒì´ ì‹œê°ì ìœ¼ë¡œ ë³´ì•˜ì„ ë•Œ ë§ì´ ë§ëŠ” ê²ƒ ê°™ì•„ë³´ì¸ë‹¤. íŒŒë‘ì´ ì„¸ ì¶• ëª¨ë‘ì—ì„œ, ë‹¤ë¥¸ ì…‹ ë“¤ì˜ ì¤‘ê°„ ì¦ˆìŒì— ìœ„ì¹˜í•˜ëŠ” ê²ƒì„ ì˜ ë³¼ ìˆ˜ ìˆë‹¤.  
        - ì–´ë–»ê²Œ êµ¬í˜„í–ˆëŠ”ì§€ ì´ì œ ì°¨ì°¨ ì„¤ëª…ì„ í•´ë³´ì. 
    <figure id="onmanifold_gaussnewton_result" align="center">
        <img src="/assets/data/2024-08-24-rot-avg1/main_onmanifold_ganussnewton_result.png" width="800">
        <figcaption>On-manifold Gauss-Newton Result</figcaption>
    </figure>

## ë°°ê²½ì§€ì‹ 1
- ì¼ë‹¨ iterative optimization ì˜ ê¸°ê³„ì ì¸ ê³¼ì •ì€ ì•„ë˜ì™€ ê°™ë‹¤ (ì´ê±¸ ë‚˜ëŠ” ê°œì¸ì ìœ¼ë¡œ 'ê¸°ê³„ì ì¸ ê³¼ì •' ì´ë¼ë˜ê°€, 'ì‚°ìˆ˜' ë¼ë˜ê°€, 'ê³„ì‚°ê¸°'ë¼ê³  ë¶€ë¥¸ë‹¤. ì¦‰, ì–´ë µì§€ ì•Šë‹¤ëŠ” ë§ì´ë‹¤). 
    - ì´ ê·¸ë¦¼ì€ ë§¤ë²ˆ ì¶”ì²œí•˜ëŠ” ìë£Œì¸, [ICRA 2016 SLAM tutorial](http://www.diag.uniroma1.it/~labrococo/tutorial_icra_2016/) ì¤‘, [Giorgio Grisetti êµìˆ˜ë‹˜ ìŠ¬ë¼ì´ë“œ](http://www.diag.uniroma1.it/~labrococo/tutorial_icra_2016/icra16_slam_tutorial_grisetti.pdf) ì—ì„œ ê°€ì ¸ì˜¨ ê²ƒì´ë‹¤. 
    <figure id="gn_manifold" align="center">
        <img src="/assets/data/2024-08-24-rot-avg1/gn_manifold.png" width="600">
        <figcaption>GN Manifold Diagram</figcaption>
    </figure>
- ì—¬ê¸°ì„œ $\textbf{J}$ ë§Œ êµ¬í•˜ë©´ ëœë‹¤. 
    - ps. ë‚´ê°€ ë‹¤ë£¨ëŠ” 1. ì„¼ì„œ íŠ¹ì„± (ì˜ˆ: ì¹´ë©”ë¼ëŠ” pixel ë¡œ êµ¬ì„±ë˜ì–´ìˆê³  ì„¸ìƒì˜ ì •ë³´ê°€ projective í•˜ê²Œ ìƒì„±ëœë‹¤) ê³¼, 2. ê·¸ ì„¼ì„œ íŠ¹ì„±ì„ ê³ ë ¤í•œ observation model (residual model) (ì˜ˆ: ê·¸ëŸ¬ë¯€ë¡œ pose ê°€ trueì˜€ë‹¤ë©´ projection í–ˆì„ ë•Œì˜ reprojection error ê°€ ì‘ì„ ê²ƒì´ë‹¤. ê·¸ê²ƒì€ (u, v) ê³µê°„ì—ì„œì˜ ê·¸ì € ë‘ ì°¨ì› ë²¡í„°ì˜ ëº„ì…ˆìœ¼ë¡œ ì •ì˜ëœë‹¤), ì´ ë‘ ê°€ì§€ë¥¼ ì–´ë–»ê²Œ ì˜ ì•Œê³  ì˜ ë‹¤ë£¨ê³  ì˜ êµ¬í˜„í•  ìˆ˜ ìˆëŠëƒê°€ ë‹¨ìˆœíˆ geometric vision ì „ê³µìë¥¼ ë„˜ì–´ì„œì„œ SLAM engineerì˜ ë„ë©”ì¸ ë†€ë¦¬ì§€ë¼ê³  í•  ìˆ˜ ìˆê² ë‹¤.  
    - Jê°€ ì–´ë–»ê²Œ êµ¬í•´ì§€ëŠëƒë§Œ ë‹¤ë¥´ì§€, ê·¸ ì´í›„ê³¼ì •ì€ ëª¨ë“  ë…¼ë¬¸ë“¤ì´ ë™ì¼í•˜ë‹¤. 

## ë°°ê²½ì§€ì‹ 2
- $\textbf{J}$ ...
- ìì½”ë¹„ì•ˆ, ì•¼ì½”ë¹„ì•ˆ, ... ë‹¤ì–‘í•˜ê²Œ ë¶ˆë¦¬ëŠ” ì´ ë…€ì„
    - ê·¸ëƒ¥ multi-dimensional ê¸°ìš¸ê¸°ë¼ê³  ìƒê°í•˜ë©´ ëœë‹¤.
    - Gauss-Newton optimization ì„ í•˜ê¸° ìœ„í•´ì„œëŠ” ê¸°ìš¸ê¸° ê°’ì„ ì•Œì•„ì•¼ í•˜ê¸° ë•Œë¬¸. 
    - [ì˜ˆì „ í¬ìŠ¤íŠ¸]({{ site.baseurl }}{% post_url 2024-05-25-reprojection-jacobian-r2live %}) ì—ì„œë„ ì´ ì–˜ê¸°ëŠ” ì´ë¯¸ í–ˆì—ˆë‹¤ (ì‚¬ì‹¤ ê²°êµ­ ë§¨ë‚  ì´ ì–˜ê¸°ë¥¼ í•˜ê²Œ ë˜ëŠ” ê²ƒì´ë‹¤ ...).
        - ì—¬ê¸°ì„œë„ ë‹¤ì‹œ ë§í•˜ìë©´, ìì½”ë¹„ì•ˆì€ ì´ë ‡ê²Œ ê¸°ì–µí•˜ë©´ ëœë‹¤. matrix ë„¤ëª¨ì˜ ì„¸ë¡œ(ì¦‰, row ë“¤) ëŠ” cost, ê°€ë¡œ(ì¦‰, columnë“¤)ëŠ” state.
- ì•„ë¬´íŠ¼ ë³¸ í¬ìŠ¤íŠ¸ì—ì„œë„ ê²°êµ­, ì–´ë–¤ residual functionì— ëŒ€í•œ, ìµœì  rotation ì˜ ë¯¸ì†Œë³€í™”ëŸ‰, ì˜ ë¯¸ë¶„ matrix (== ìì½”ë¹„ì•ˆ) ë¥¼ ê³„ì‚°í•˜ëŠ” ê²ƒì´ ê´€ê±´ì´ ëœë‹¤. 
- rotation ì— ëŒ€í•´ í•´ë³´ì. 

## ìœ ë„ ê³¼ì • (Derivation)
- iterative í•˜ê²Œ an averaged rotation ê°’ì„ ì˜ˆì¸¡í•  ê²ƒì´ë¯€ë¡œ, 
- í˜„ì¬ ($t$ ë²ˆì§¸ step) ê¹Œì§€ ì˜ˆì¸¡ëœ ê°’ì„ $\textbf{R}^{(t)}$ ì´ë¼ê³  í•´ë³´ì. 
    - == [ìœ„ì˜ í‹°ì € ê·¸ë¦¼](#onmanifold_gaussnewton_result)ì—ì„œ íŒŒë‘ í™”ì‚´í‘œ (í˜¹ì€ ì´ê²ƒì— ë„ë‹¬í•˜ê¸° ì „ì˜ ìŠ¤í…)
- ê·¸ë¦¬ê³  ì–´ë–¤ measurement $\textbf{R}_1$, $\textbf{R}_2$, $\textbf{R}_3$ ì´ë ‡ê²Œ 3ê°œê°€ ìˆì—ˆë‹¤ê³  í•˜ì. 
    - == [ìœ„ì˜ í‹°ì € ê·¸ë¦¼](#onmanifold_gaussnewton_result)ì—ì„œ íŒŒë‘ì„ ì œì™¸í•œ ë‚˜ë¨¸ì§€ í™”ì‚´í‘œë“¤
- ê·¸ëŸ¬ë©´, ì´ ì„¸ ê°œì˜ measurement ë¡œë¶€í„° ê°ê° $\textbf{H}_i$ ì™€ $\textbf{e}_i$ ê°€ ìƒì„±ë˜ê³ , 
- ì „ì²´ $\textbf{H}$ ì™€ $\textbf{b}$ ëŠ” [ì•ì„œ ì†Œê°œí•œ tutorial slide](#gn_manifold) ì—ì„œ ì„¤ëª…í•œëŒ€ë¡œ (ë‹¨ìˆœí•œ ë§ì…ˆìœ¼ë¡œ!) ì–»ì–´ì§€ê²Œ ëœë‹¤. 
    - ì½”ë“œë¡œë„ ë‹¹ì—°íˆ ë„ˆë¬´ ê°„ë‹¨í•˜ë‹¤. 
    ```python
        H += J_i.T @ J_i 
        b += J_i.T @ e_i 
    ```
- ê·¸ëŸ¼ ìš°ë¦¬ê°€ ì§€ê¸ˆ ìœ ë„í•˜ë ¤ëŠ” ê²ƒì€ ê²°êµ­ ì € `J_i` ì™€ `e_i` ê°€ ë¬´ì—‡ì¸ê°€ í•˜ëŠ” ê²ƒì´ë‹¤. 
- `J_i` ëŠ” `e_i`ë¥¼ ë¯¸ë¶„í•¨ìœ¼ë¡œì¨ ì–»ì–´ì§€ëŠ” ê²ƒì´ë¯€ë¡œ, ë¨¼ì € `e_i` ë¥¼ ì •ì˜í•´ì•¼ í•œë‹¤. 
- `e_i`ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤. 
    - ìš°ë¦¬ëŠ” iteratively gauss newton optimization ì„ ìˆ˜í–‰í•  ê²ƒì´ë¯€ë¡œ 
    - ê·¸ ìµœì ì¡°ê¸ˆì›€ì§ì„ í•´ëŠ” rotation ì˜ tangent space ì—ì„œë§Œ ì •ì˜ê°€ ê°€ëŠ¥í•˜ë‹¤. ê±°ê¸°ë§Œì´ vector spaceì´ê¸° ë•Œë¬¸ì´ë‹¤. 
        - ì´ ë§ì´ ì´í•´ê°€ ê°€ì§€ ì•ŠëŠ”ë‹¤ë©´ ì˜ˆì „ í¬ìŠ¤íŠ¸ë¥¼ ì½ê³  ì˜¤ê¸°ë¥¼ ì¶”ì²œí•œë‹¤. [ì˜ˆì „ í¬ìŠ¤íŠ¸1]({{ site.baseurl }}{% post_url 2023-12-16-nano-lie-theory %}) ì™€ [ì˜ˆì „ í¬ìŠ¤íŠ¸2]({{ site.baseurl }}{% post_url 2024-05-25-reprojection-jacobian-r2live %}).
    - ì›ë˜ì˜ rotation ê³µê°„ì¸ $\mathrm{SO(3)}$ ì—ì„œì˜ residual (ì€ 3 by 3 matrix ì´ë‹¤) ì— $\textbf{Log}(\cdot)$ ì—°ì‚°ì„ ì·¨í•´ì£¼ë©´ 3-dim vectorê°€ ìƒì„±ëœë‹¤. 
    - ê·¸ê²ƒì´ ìš°ë¦¬ì˜ `e_i`ê°€ ëœë‹¤. 
    - ì™œ ê·¸ë ‡ê²Œ í•˜ëƒê³  ë¬»ëŠ”ë‹¤ë©´, ë‹¤ì‹œ ìš”ì•½í•˜ìë©´, Gauss-Newton opt ëŠ” vector space ì—ì„œë§Œ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ”ë°, ê·¸ê²ƒì€ $\mathrm{SO(3)}$ ì˜ tangent spaceì¸ $\mathfrak{so(3)}$ ì—ì„œ ì •ì˜ëœë‹¤ê³  í•  ìˆ˜ ìˆë‹¤. ê·¸ë˜ì„œ ìš°ë¦¬ëŠ” $\mathrm{SO(3)}$ ì—ì„œ distance ë¥¼ êµ¬í•˜ê³ , ê±°ê¸°ì— $\textbf{Log}(\cdot)$ ì—°ì‚°ì„ ì·¨í•´ì„œ, $\mathfrak{so(3)}$ ìƒì—ì„œì˜ distance ë¥¼ ì •ì˜í–ˆë‹¤ê³  í•  ìˆ˜ ìˆë‹¤. 
        - ps. ì™œ $\textbf{Log}(\cdot)$ ì—°ì‚°ì„ ì·¨í•´ì•¼, $\mathfrak{so(3)}$ ìƒì—ì„œì˜ distance ê°€ ë˜ëŠ”ì§€ì— ëŒ€í•´ì„œëŠ” ì—¬ê¸°ì—ì„œ ë” ì„¤ëª…í•˜ì§€ëŠ” ì•ŠëŠ”ë‹¤. ê·¸ê²ƒì€ ì•½ê°„ ê¸°ë³¸ì´ê¸° ë•Œë¬¸... ì—¬ê¸°ì„œë¶€í„°ëŠ” [Quaternion kinematics for the error-state Kalman filter](https://arxiv.org/abs/1711.02508) ì´ë‚˜, ì•„ë‹ˆë©´ ë‹¤ë¥¸ ë…¼ë¬¸ë“¤ì„ ì°¸ê³  ë°”ëŒ.
    - ê·¸ë¦¬ê³  $\textbf{Log}(\cdot)$ ëŠ” ì‚¬ì‹¤ $\textbf{log}(\cdot)$ ë¼ëŠ” ì—°ì‚°ì— unskew ë¥¼ í•´ì£¼ëŠ” ê³¼ì •ì„ ë”í•œ ê²ƒì„, ê°„ë‹¨í•˜ê²Œ ë¬¸ìë¡œ í‘œí˜„í•˜ë ¤ê³  lì„ Lë¡œë§Œ ë°”ê¿”ì“´ê²ƒì´ë‹¤. 
- ê·¸ëŸ¼ ì´ì œê¹Œì§€ tangent space ìƒì—ì„œì˜ error function (our observation model) ì„ ì •ì˜í–ˆìœ¼ë‹ˆ, ì´ê²ƒì˜ Jacobianì„ êµ¬í•´ë³´ì. 
- ë¨¼ì €, `e_i`ì˜ ìˆ˜ì‹ì„ ì½”ë“œê°€ ì•„ë‹ˆë¼ latexìœ¼ë¡œ ë‹¤ì‹œ ì ì–´ë³´ì. 
    - $e_i = \\textbf{Log}(error(\mathbf{R}))$ ì´ê³ , ì—¬ê¸°ì„œ $error(\mathbf{R})$ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì •ì˜ëœë‹¤. $error(\mathbf{R}) = \mathbf{R}\_{\text{measurement}} \ominus \mathbf{R}\_{\text{estimated}} = \mathbf{R}\_{\text{estimated}}^\top \cdot \mathbf{R}\_{\text{measurement}}$
        - ì™œ transpose ì˜ ì™¼ìª½ê³±ì´ ë˜ëŠ”ì§€ ê¹Œì§€ ì—¬ê¸°ì„œ ì„¤ëª…í•˜ì§€ëŠ” ì•ŠëŠ”ë‹¤..
- ì•ì„œ ìš°ë¦¬ì˜ measurement ë¥¼ ê°„ë‹¨íˆ $\mathbf{R}_{i}$ ë¼ ë¶ˆë €ê³  (ì˜ˆ: $\mathbf{R}\_{1}$, $\mathbf{R}\_{2}$, $\mathbf{R}\_{3}$), ìš°ë¦¬ì˜ \(step $t$ì—ì„œì˜\) ì˜ˆì¸¡ê°’ì„ $\mathbf{R}^{(t)}$ë¼ê³  ë¶ˆë €ìœ¼ë‹ˆ, ë‹¤ì‹œ ì‹ì„ ì¨ë³´ë©´ 
- $e_i = \textbf{Log}({\mathbf{R}^{(t)}}^\top \cdot \mathbf{R}_{i})$ ë¼ê³  í•  ìˆ˜ ìˆë‹¤. 
- ì´ì œ $\mathbf{J}_i$ë¥¼ ë…¼í•  ìˆ˜ ìˆë‹¤. 
- $\mathbf{J}_i$ëŠ”, ìš°ë¦¬ì˜ ê´€ì‹¬ì‚¬(ìµœì ì¡°ê¸ˆì›€ì§ì„ê°’ì´ ì–¼ë§ˆì¸ì§€)ì¸ tangent space ì—ì„œì˜ value (rotation vector ë¼ê³  í•˜ì) ì¸, ì´ 3-dim vectorì¸ ì´ ê°’ì´ ì¡°ê¸ˆ ì›€ì§ì¼ ë•Œ, ìœ„ì˜ $e_i$ê°€ ì–¼ë§ˆë‚˜ ë³€í•˜ëŠ”ì§€? ë¡œ ì •ì˜ëœë‹¤. 
- ê·¸ ìµœì ìœ¼ë¡œ ì¡°ê¸ˆ ì›€ì§ì¸ rotation vector ë¥¼ $\delta \boldsymbol{\theta}$ë¼ê³  í•˜ë©´, (ps. ì¡°ê¸ˆì´ë¼ëŠ” ì˜ë¯¸ì—ì„œ $\delta$ ë¥¼ ë¶™ì„)
- ì´ ë•Œ (== step $t$ì—ì„œ ì¡°ê¸ˆë§Œ ìµœì ìœ¼ë¡œ ë” ì›€ì§ì—¬ ë³¸)ì˜, ì˜ˆì¸¡ ê°’ì€ $\{\(\mathbf{R}^{(t)} \oplus \delta\boldsymbol{\theta}\)}$ ê°€ ë˜ê³ , 
- $e_i$ëŠ” ë”°ë¼ì„œ $\textbf{Log}(\{\(\mathbf{R}^{(t)} \oplus \delta\boldsymbol{\theta}\)}^\top \cdot \mathbf{R}_{i})$ ê°€ ë˜ë©°, 
    - ps. ì´ ë•Œ $\oplus$ë€ matmul ì„ ì˜ë¯¸í•œë‹¤. í•˜ì§€ë§Œ ì™œ ê·¸ë ‡ê²Œ ì“°ë‚˜ë©´, $\delta\boldsymbol{\theta}$ ëŠ” vector ì´ê³ , rotation matrix ê°€ ì‚´ê³ ìˆëŠ” SO(3) ì— ì‚´ê³ ìˆì§€ ì•Šê¸° ë•Œë¬¸ì—, ì¼ë°˜ì ì¸ ë”í•˜ê¸°ë‚˜ ê³±í•˜ê¸° (i.e., $\cdot$) ê¸°í˜¸ë¥¼ ì“°ë©´ ë…¼ë¦¬ê°€ ë§ì§€ì•Šê²Œ ë˜ì–´ í¸ì˜ìƒ $\oplus$ ë‚˜ $\boxplus$ì™€ ê°™ì€ ê¸°í˜¸ë¡œ í‘œê¸°í•˜ëŠ” í’ìŠµì´ ìˆë‹¤. ì‹¤ì œë¡œëŠ” oplus ê°€ ì í˜€ìˆë‹¤ë©´, rotation vector ì— Expë¥¼ ì·¨í•œ ë’¤ matmul ì„ í•´ì¤€ë‹¤ ë¼ê³  ì´í•´í•˜ë©´ ëœë‹¤.
        - ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ë‹¤ì–‘í•œ ê³µë¶€ìë£Œë“¤ë¡œ ê·¸ ì„¤ëª…ì„ ëŒ€ì‹ í•œë‹¤. 
            - [Integrating Generic Sensor Fusion Algorithms with Sound State Representations through Encapsulation of Manifolds](https://arxiv.org/pdf/1107.1119)
            - [A tutorial on SE(3) transformation parameterizations and on-manifold optimization](https://ingmec.ual.es/~jlblanco/papers/jlblanco2010geometry3D_techrep.pdf)
            - [Lie Theory for State Estimation in Robotics](https://xipengwang.github.io/lie-theory/#$\boxplus$-and-$\boxminus$)
- $J_i = \frac{\partial e\_{i}(\delta \boldsymbol{\theta})}{\partial \delta\boldsymbol{\theta}} = \frac{\partial \textbf{Log}(\{\(\mathbf{R}^{(t)} \oplus \delta\boldsymbol{\theta}\)}^\top \cdot \mathbf{R}_{i})}{\partial \delta\boldsymbol{\theta}}$ ê°€ ëœë‹¤. 
- ì´ê²ƒì´ ì‹¤ì œë¡œ ì½”ë“œìƒìœ¼ë¡œ ì–´ë–»ê²Œ êµ¬í˜„ì´ ë˜ëŠ”ì§€, symforce ë“±ì— ë§¡ê²¨ë„ ë˜ê² ì§€ë§Œ... 
- ìš°ë¦¬ê°€ ì•Œê³  ìˆëŠ” rotation ì˜ ìœ ìš©í•œ ìˆ˜ì‹ë“¤ì„ ì˜ ì¡°í•©í•´ì„œ, ì˜ í’€ì–´ì„œ deterministic í•˜ê²Œ ì¨ë‚´ë©´ (== ì½”ë“œë¡œ ì˜®ê¸°ê¸° ì‰¬ìš´ í˜•íƒœ) ìš°ë¦¬ì˜ ëª©í‘œ ë‹¬ì„±ì´ë‹¤. 
- íŠ¸ë¦­ 1 
    - $\{\mathbf{R}^{(t)} \oplus \delta\boldsymbol{\theta}}$ ì€ 
    - $\mathbf{R}^{(t)} \cdot \textbf{Exp}(\delta\boldsymbol{\theta})$ ì¸ë°, 
        - ì—¬ê¸°ì„œ, $\delta\boldsymbol{\theta}$ ê°€ ì‘ì€ ê°’ì¼ ë•ŒëŠ” (ìµœì  'ì¡°ê¸ˆ'ì›€ì§ì„ ê°’ì´ë¯€ë¡œ ì´ë ‡ê²Œ ê°€ì •í•  ìˆ˜ ìˆìŒ) 
        - $\textbf{Exp}(\delta\boldsymbol{\theta}) \sim \textbf{I} + \[\delta\boldsymbol{\theta}\]_{\times}$ ë¡œ ê·¼ì‚¬í•  ìˆ˜ ìˆë‹¤. 
            - note: $\[ ... ]_{\times}$ ëŠ” inputì´ 3-dim vectorì´ê³ , outputì´ skew symmetric matrix ì¸ í•¨ìˆ˜ë¥¼ ì˜ë¯¸í•œë‹¤.
    - ê·¸ëŸ¬ë©´ ë‹¤ì‹œ, $\mathbf{R}^{(t)} \cdot \textbf{Exp}(\delta\boldsymbol{\theta}) = \mathbf{R}^{(t)} \cdot \(\textbf{I} + \[\delta\boldsymbol{\theta}\]_{\times}\)$ ê°€ ëœë‹¤. 
- ê·¸ëŸ¬ë©´ $J_i = \frac{\partial \textbf{Log}(\{\(\mathbf{R}^{(t)} \oplus \delta\boldsymbol{\theta}\)}^\top \cdot \mathbf{R}_{i})}{\partial \delta\boldsymbol{\theta}}$ ëŠ” 
    - $J_i = \frac{\partial \textbf{Log}({ (\mathbf{R}^{(t)} \cdot \(\textbf{I} + \[\delta\boldsymbol{\theta}\]\_{\times}\)) }^\top \cdot \mathbf{R}_{i})}{\partial \delta\boldsymbol{\theta}}$ ì™€ ê°™ì´ ë‹¤ì‹œ ì“¸ ìˆ˜ ìˆë‹¤. 
- íŠ¸ë¦­ 2
    - $\textbf{Log}(\cdot)$ ì—°ì‚°ìë¥¼ $\text{unskew}\(\textbf{log}(\cdot\))$ ì´ë ‡ê²Œ ë‚˜ëˆ ì„œ ì“¸ ìˆ˜ ìˆë‹¤. ì—¬ê¸°ì„œ unskew ë¼ëŠ” ë§ì€ ê·¸ëƒ¥ í¸ì˜ìƒ ë‚´ê°€ ë¶™ì¸ ë§ì´ë©° (ì¢€ ë” ì½”ë“œ ì¹œí™”ì ìœ¼ë¡œ ì„¤ëª…í•˜ê¸° ìœ„í•´ì„œ), ì‹¤ì œë¡œëŠ” ìŠ¤íì‹œë©”íŠ¸ë¦­ í–‰ë ¬ì„ ë²¡í„°ë¡œ ë‹¤ì‹œ ë³€í™˜í•˜ëŠ” ì—°ì‚°ì„ "vee" ì—°ì‚°ì´ë¼ê³  í”íˆ ë¶€ë¥¸ë‹¤. $\vee$ ê¸°í˜¸ë¡œ ì“´ë‹¤. 
    - ê·¸ëŸ¬ë©´ $J_i = \frac{\partial \texttt{vee}(\textbf{log}({ (\mathbf{R}^{(t)} \cdot \(\textbf{I} + \[\delta\boldsymbol{\theta}\]\_{\times}\)) }^\top \cdot \mathbf{R}_{i}))}{\partial \delta\boldsymbol{\theta}}$ ì™€ ê°™ì´ ë‹¤ì‹œ ì“¸ ìˆ˜ ìˆë‹¤. 
- íŠ¸ë¦­ 3 
    - $(AB)^\top = B^\top \cdot A^\top$ ì„ ì´ìš©í•´ì„œ, $\textbf{log}(\cdot)$ ì•ˆì˜ ì‹ì„ ì •ë¦¬í•˜ë©´ 
    - $\left( \mathbf{R}^{(t)} \cdot (\mathbf{I} + [\delta\boldsymbol{\theta}]\_\times) \right)^\top = (\mathbf{I} + [\delta\boldsymbol{\theta}]\_\times)^\top \cdot (\mathbf{R}^{(t)})^\top$ ê°€ ëœë‹¤. 
- íŠ¸ë¦­ 4
    - skew-symmetric matrixì˜ ì •ì˜ë¥¼ ì‚¬ìš©í•˜ë©´, $([\delta\boldsymbol{\theta}]\_\times)^\top = -[\delta\boldsymbol{\theta}]\_\times$ ì´ë‹¤. 
    - ê·¸ë¦¬ê³  $(A + B)^\top = A^\top + B^\top$  ì´ë¯€ë¡œ 
    - ìœ„ì˜ í…€ $\left( \mathbf{R}^{(t)} \cdot (\mathbf{I} + [\delta\boldsymbol{\theta}]\_\times) \right)^\top = (\mathbf{I} + [\delta\boldsymbol{\theta}]\_\times)^\top \cdot (\mathbf{R}^{(t)})^\top$ ì€ $ = (\mathbf{I} - [\delta\boldsymbol{\theta}]\_\times) \cdot (\mathbf{R}^{(t)})^\top$ ê°€ ëœë‹¤. 
    - ì´ì œ ê·¸ëŸ¬ë©´ residual ì‹ì€ $e_i(\delta\boldsymbol{\theta}) = \textbf{Log}\left( (\mathbf{I} - [\delta\boldsymbol{\theta}]\_\times) \cdot (\mathbf{R}^{(t)})^\top \cdot \mathbf{R}\_i \right)$ ê°€ ëœë‹¤. 
- íŠ¸ë¦­ 5
    - ì—¬ê¸°ì„œ $\mathbf{E} = (\mathbf{R}^{(t)})^\top \cdot \mathbf{R}\_i$ ë¼ê³  í•  ë•Œ, 
    - ìµœì í™” ê³¼ì •ì—ì„œ í˜„ì¬ ì¶”ì •ì¹˜ $\mathbf{R}^{(t)}$ëŠ” ì¸¡ì •ì¹˜ $\mathbf{R}\_i$ì— ê·¼ì ‘í•˜ë¯€ë¡œ $\mathbf{E}$ëŠ” ë‹¨ìœ„ í–‰ë ¬ì— ê·¼ì ‘í•œë‹¤. 
        - ì¦‰, $\mathbf{E} \sim \mathbf{I}$ ë¼ê³  í•  ìˆ˜ ìˆë‹¤. 
    - ë”°ë¼ì„œ:
        - $e_i(\delta\boldsymbol{\theta}) = \textbf{Log}\left( (\mathbf{I} - [\delta\boldsymbol{\theta}]\_\times) \cdot \mathbf{E} \right) = \texttt{vee}(\textbf{log}\left( (\mathbf{I} - [\delta\boldsymbol{\theta}]\_\times) \cdot \mathbf{E} \right)) = \texttt{vee}(\textbf{log}\left( (\mathbf{I} - [\delta\boldsymbol{\theta}]\_\times)  \right))$ ë¡œ ê·¼ì‚¬í•  ìˆ˜ ìˆë‹¤. 
- íŠ¸ë¦­ 5
    - í…Œì¼ëŸ¬ ì „ê°œë¥¼ ì´ìš©í•˜ì 
    - $\textbf{log}(\mathbf{I} + \mathbf{A}) = \mathbf{A} - \frac{1}{2}\mathbf{A}^2 + \frac{1}{3}\mathbf{A}^3 - \cdots$ ì´ë‹¤. 
    - 2ì°¨ í•­ ì´ìƒì€ ì‘ìœ¼ë¯€ë¡œ ë¬´ì‹œí•˜ë©´, 
    - $\textbf{log}\left( (\mathbf{I} - [\delta\boldsymbol{\theta}]\_\times)  \right) \sim - [\delta\boldsymbol{\theta}]\_\times$ ì´ë‹¤. 
- ê²°ë¡  
    - ë”°ë¼ì„œ $J_i = \frac{\partial e\_{i}(\delta \boldsymbol{\theta})}{\partial \delta\boldsymbol{\theta}} = \frac{\partial \textbf{Log}(\{\(\mathbf{R}^{(t)} \oplus \delta\boldsymbol{\theta}\)}^\top \cdot \mathbf{R}_{i})}{\partial \delta\boldsymbol{\theta}} = \frac{\partial \texttt{vee}(\textbf{log}\left( (\mathbf{I} - [\delta\boldsymbol{\theta}]\_\times)  \right))}{\partial \delta\boldsymbol{\theta}} = \frac{\partial \texttt{vee}(- [\delta\boldsymbol{\theta}]\_\times)}{\partial \delta\boldsymbol{\theta}} = \frac{\partial \texttt{unskew}(- \texttt{skew}(\delta\boldsymbol{\theta}))}{\partial \delta\boldsymbol{\theta}} = \frac{\partial (- \delta\boldsymbol{\theta})}{\partial \delta\boldsymbol{\theta}}  = -\mathbf{I} $ ê°€ ëœë‹¤. 
        - ps. $\texttt{vee}$ ì™€ $\texttt{unskew}$ ëŠ” ê°™ì€ í‘œí˜„ì´ë‹¤. skew ì‘ì—…ì„ ì—­ìœ¼ë¡œ í•´ì¤€ë‹¤ëŠ” ì˜ë¯¸ì—ì„œ ì½”ë“œì—ì„œëŠ” unskew ë¼ê³  ì ëŠ”ê²Œ ì¢€ ë” ì´í•´ê°€ ì‰¬ì›Œì„œ ê·¸ë ‡ê²Œ í‘œí˜„í•´ë³´ì•˜ë‹¤.  ë§ˆì°¬ê°€ì§€ë¡œ $[\cdot ]\_\times$ ë¼ëŠ” í‘œí˜„ë³´ë‹¤ëŠ” $\texttt{skew}$ ë¼ê³  ì ìœ¼ë©´ ì¢€ ë” ì§ì´ ë§ëŠ” ë“¯í•œ ëŠë‚Œì´ë‹¤ (ì½”ë“œ ë ˆë²¨ì—ì„œ ë” ì¢‹ì€ ê°€ë…ì„± ë³´ìœ  ê°€ëŠ¥).

## êµ¬í˜„ 
- ì§€ê¸ˆê¹Œì§€ e ì™€ Jë¥¼ êµ¬í–ˆë‹¤. 
- ë”°ë¼ì„œ ì½”ë“œë ˆë²¨ì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤. ë§¤ìš° ê°„ë‹¨í•˜ë‹¤. 
    ```python
    # Initialized at the first step's solution
    R_optimal = ... # e.g., = R1 

    # Gauss-newton update 
    for i in range(max_iters):
        H = np.zeros((3, 3))
        b = np.zeros(3)
        
        # gather measurements 
        for R_i in [R1, R2, R3]:
            e_i = unskew(log(np.dot(R_optimal.T, R_i))) 
            J_i = -1 * np.eye(3) 

            H += J_i.T @ J_i 
            b += J_i.T @ e_i 
        
        # solve the normal equation H * dtheta = -b 
        dtheta_optimal = np.linalg.solve(H, -b)
        
        # check termination condition (convergenceness)
        print(f"iter {i}: dtheta: {dtheta}")
        if np.linalg.norm(dtheta) < tolerance:
            print(f"The solution converged. terminate the GN opt at iteration {i}\n")
            break
        
        # update the solution 
        R_optimal = R_optimal @ Exp(dtheta_optimal)

        # (optional) ì—…ë°ì´íŠ¸ í•œ SO(3) ê°€ ì •ì˜ë¥¼ ë§Œì¡±í•˜ë„ë¡ ê°•ì œ (make det = 1)
        U, _, Vt = np.linalg.svd(R0)
        R0 = np.dot(U, Vt)
        if np.linalg.det(R0) < 0:
            U[:, -1] *= -1
            R0 = np.dot(U, Vt)

    ```

## ê²°ë¡  
-  ì½”ë“œì—ì„œ ë§ˆì§€ë§‰ì— `# update the solution` ë¶€ë¶„ì—ì„œ, tangent spaceì—ì„œ ì–»ì€ ìµœì ì¡°ê¸ˆì›€ì§ì„ ê°’ì„ ì›ë˜ rotationì— ì²¨ê°€í•´ì£¼ëŠ” ê²ƒì„ "retract" operation ì´ë¼ê³  ë¶€ë¥¸ë‹¤. ì „ì²´ ê³¼ì •ì€ lift-solve-retract pipeline ì´ë¼ê³  ë¶ˆë¦¬ê¸°ë„ í•œë‹¤. [ì˜ˆì „ í¬ìŠ¤íŠ¸]({{ site.baseurl }}{% post_url 2023-12-16-nano-lie-theory %}) ì—ì„œ ì–¸ê¸‰í•´ë‘ì—ˆìŒ. 
- [2016 T-RO Paper ì¸ On-Manifold Preintegration for Real-Time Visual-Inertial Odometry](https://arxiv.org/abs/1512.02363) ì˜ ë³¸ì§ˆë„ ì‚¬ì‹¤ ì´ê²ƒì´ ì „ë¶€ì´ë©°... ì«„ í•„ìš”ê°€ ì—†ê² ë‹¤. 
- ê²°ë¡ ì ìœ¼ë¡œ ê°„ë‹¨í•œ measurement 3ê°œ ì§œë¦¬ rotation averaging ì´ë¼ëŠ” taskë¥¼ ì§ì ‘ from-scratch ë¶€í„° êµ¬í˜„í•´ë´„ìœ¼ë¡œì¨, ê²°ë¡ ì ìœ¼ë¡œëŠ” ìµœì‹  visual inertial odometry ë°©ë²•ë„ ì´ë¡ ì ìœ¼ë¡œëŠ” ê°™ë‹¤ëŠ” ì´ì•¼ê¸°ë¥¼ í•˜ê³  ì‹¶ì—ˆë‹¤. 


## ì‹¤ìŠµ
- ì‹¤ìŠµ ì½”ë“œëŠ” ì—¬ê¸° ([main_onmanifold_ganussnewton.py](https://github.com/gisbi-kim/numerical_geometric_programming_lectures/blob/main/python/single_rotation_averaging/main_onmanifold_ganussnewton.py)) ì— ìˆë‹¤. (ë””íœë˜ì‹œëŠ” ìœ ëª…í•œ numpy ì™€ matplotlib ì´ë¯€ë¡œ ë³„ë„ ë„ì»¤í™˜ê²½ ì„¤ì •ì€ ìƒëµí•˜ê³  ì‹¤ìŠµí•´ë³´ì.)
- GN ìµœì í™” ê³¼ì •ì—ì„œ weight ë¥¼ ê³ ë ¤í•œ update ì˜ˆì‹œë¥¼ êµ¬í˜„í•´ë³´ì. ì˜ˆë¥¼ ë“¤ì–´ì„œ 3ê°œì˜ measurement ì¤‘ í•˜ë‚˜ë¥¼ íŠ¹íˆ ë” ì‹ ë¢°í•˜ê³  ì‹¶ë‹¤ë©´? 
    - ì´ë¥¼ ë” í™•ì¥í•˜ë©´ outlier robust rotation averaging ê¹Œì§€ ì‹¤ìŠµí•´ë³¼ ìˆ˜ ìˆê² ë‹¤. ì‹¬í•œ outlier ë¥¼ í¬í•¨í•œ, 100ê°œì˜ measurement ì¸ ê²½ìš°ë¡œ í™•ëŒ€í•´ë³´ì. 